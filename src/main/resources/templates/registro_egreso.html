<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head th:replace="design/header :: head">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body class="bg-sistemasIntegrales" onload="hideMessage()">
    <!-- Mostrar el mensaje si está presente -->
    <div th:if="${message}" id="notificationMessage"
        th:classappend="${messageType == 'success'} ? 'alert alert-success' : 'alert alert-danger'"
        style="padding: 10px; margin-bottom: 15px; border-radius: 5px;">
        <span th:text="${message}"></span>
    </div>
<div class="container" style="width: 80%;">
    <div class="card o-hidden border-0 shadow-lg my-2">
        <div class="card-body p-0">
            <!-- Nested Row within Card Body -->
            <div>
                <div>
                    <div class="p-3">
                    	<div class="box box-primary">
	 						<div class="box-header with-border">
							<h6>PROJECT DETAILS</h6>
							</div>
							<div class="box-body">
								<div class="row-header-max">
									<div class="col-6">
										<div class="row-header">
											<div class="col-7">
												<strong><i class="fa fa-book margin-r-5"></i> Project Name</strong>
												<p class="p-header"  th:text="${project.nombre}">PROJECT IDB	</p>
											</div>
											<div class="col-5">
												<strong>Country</strong>
												<p  class="p-header"  th:text="${project.pais}">Chile</p>
											
											</div>
										</div>
										<div class="row-header">
											<div class="col">
												<strong>Dates</strong>
												<p class="p-header"  th:text="${#dates.format(project.fechaInicial, 'MM/dd/yy') + ' - ' + #dates.format(project.fechaFin, 'MM/dd/yy')}"></p>

											</div>
											<div class="col">
												<strong>Financier</strong>
												<p class="p-header"  th:text="${project.cliente}"></p>

											</div>											
										</div>
									</div>
									<div class="col-6">
										<div class="row-header-montos">
											<div class="col">
												<strong><i class="fa fa-money margin-r-5"></i> Contract Amount (USD)</strong>
												<p class="p-header"  th:text="${#numbers.formatDecimal(project.montoContrato, 1, 'COMMA', 2, 'POINT')}">$100,000.00</p>
											</div>
										</div>	
										<div class="row-header-montos">
											<div class="col-6">
												<strong><i class="fa fa-money margin-r-5"></i> Recurring Amount (USD)&nbsp;&nbsp;
														<span th:text="${#numbers.formatDecimal(project.porcentajeRecurrente, 1, 'COMMA', 2, 'POINT')}+ '%'">0.00%</span>
												
												</strong>
												<p class="p-header"  th:text="${#numbers.formatDecimal(project.montoRecurrente, 1, 'COMMA', 2, 'POINT')}">$20,000.00</p>
											</div>
											<div class="col-6">
												<strong><i class="fa fa-money margin-r-5"></i> Non-Recurring Amount (USD)</strong>
												<p  class="p-header" th:text="${#numbers.formatDecimal(project.montoNoRecurrente, 1, 'COMMA', 2, 'POINT')}">$80,000.00</p>
											</div>								
										</div>	
									</div>
								</div>
								<hr>
	
							</div>
							
						</div>
                        <div class="text-center">
                       
                            <h2 th:if="${expense.id == null}">Expense Register</h2>
                            <h2 th:if="${expense.id != null and expense.id != 0}">Expense Edit</h2>
                        </div>
                        <form id="miFormulario"  class="user" th:action="@{/expenses/guardar-egreso}" th:method="post" th:object="${expense}">
                            <input type="hidden" th:if="${expense.id!=0}"  th:field="*{id}" th:value="${expense.id}">
                            <div class="form-group">
                                <input type="hidden" th:value="${project.id}" id="inputproyectoId" name="inputproyectoId">
                            </div>
                            <div class="row">
                            	<div class="col-6">
                            		<div class="row">
                            			<div class="col-8">
				                            <div class="form-group">
				                                <label for="inputaccount" class="form-label">Project Phases</label>
													<select th:field="*{proyectoFase}" class="form-control form-control-user" id="inputtipo" required>
													    <option value="" th:if="${expense.id == null}" disabled>Select phase</option>
													    <option th:each="faseproyecto : ${fasesProyecto}" th:value="${faseproyecto.id}"
													    		th:text="${faseproyecto.fase.nombre+ ' - (' + #numbers.formatDecimal(faseproyecto.presupuesto, 1, 'COMMA', 2, 'POINT')+' USD)'}" ></option>
													    
													</select>
				                             </div>                               			
                            			</div>
                            			<div class="col-4">
				                            <div class="form-group">
				                                <label for="inputtipo" class="form-label">Type of Expense</label>
													<select th:field="*{tipo}" class="form-control form-control-user" id="inputtipo" required>
													    <option value="" th:if="${expense.id == null}" disabled>Select type</option>
													    <option value="Non-Recurring" th:selected="${expense.tipo == 'Non-Recurring' or expense.tipo == null}">Non-Recurring</option>
													    <option value="Recurring" th:selected="${expense.tipo == 'Recurring'}">Recurring</option>
													    
													</select>
				                             </div>                               			
                            			</div>
                            		</div>
                         	
                            	</div>  
                            	<div class="col-6">
		                            <div class="form-group">
		                                <label for="inputClassification" class="form-label">Classification of Expense</label>
		                                <select th:field="*{clasificacionEgreso}" class="form-control  form-control-user" onchange="toggleFields(this);toggleFechaFin(this);"
		                               			 required>
		                                	<option value="" th:if="${expense.id == null}"  disabled >Select classification</option>
		                                    <option th:each="classification : ${expenditureClassifications}" th:value="${classification.id}"
		                                            th:data-nombreClase="${classification.nombreClase}"
		                                            th:text="${classification.nombreClase +' -> '+classification.formaPago}"></option>
		                                </select>
		                             </div>                            	
                            	</div>                            	                          	
                            </div>
                            <div class="row">
                            	<div class="col-6">
		                             <div class="form-group">
		                             	 <label for="inputObjetoPuesto" id="expenseObjetoPuesto" class="form-label"></label>
		                                 <input th:field="*{objeto}" type="text" class="form-control form-control-user" 
		       									id="inputObjetoPuesto" name="inputObjetoPuesto" placeholder="Enter object or position in the company">
		                             </div>
                            	</div>
                            	<div class="col-6">
                            		<div class="row">
                            			<div class="col-9">
				                             <div class="form-group">
				                             	 <label for="inputCargoItem" id="expenseCargoItem" class="form-label"> </label>
				                                 <input type="text" class="form-control form-control-user" 
				       									id="inputItem" name="inputItem" placeholder="Enter item"  style="display: none;"
				       									oninput="updateCargoItem(this.value)">
				       									<!-- en caso de item, deberia carga un combo-->
				                                <select id= "selectCargo" name= "selectCargo" class="form-control  form-control-user" 
				                                	required  style="display: none;"  onchange="updateCargoItem(this.options[this.selectedIndex].value)">
				                                	<option value="" disabled selected>Select expense</option>
				                                    <option th:each="escala : ${escalas}" 
				                                    		th:value="${escala.nombre}"
				                                            th:text="${escala.nombre +' - (' + #numbers.formatDecimal(escala.salario, 1, 'COMMA', 2, 'POINT')+' USD)'}" ></option>
				                                </select>	 	  
				                                 <input  th:field="*{cargoItem}" type="hidden" class="form-control form-control-user" 
				       									id="inputCargoItem" name="inputCargoItem" >     									
				                             </div>                            			
                            			</div>
		                            	<div class="col-3">
		                            		<label for="btnAddCargo" class="form-label"> &nbsp;&nbsp;</label>
					                         <button type="button" id ="btnAddCargo" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales" 
					                         	data-toggle="modal" data-target="#cargoModal"  onclick="showOverlay()" style="display: none;">
					                               Add
					                         </button>	                            	
		                            	</div> 
                            		</div>

                            	</div>                            	
                            </div>		
                            <div class="row">
                            	<div class="col-11">
                            		<label for="beneficiarioE" class="form-label">Beneficiary </label>
 								    <select  th:field="*{beneficiario}" id="beneficiarioE" name="beneficiarioE" class="form-control form-control-user" 
 								    		data-show-subtext="true" data-live-search="true" onchange="loadBeneficiaryData()">
								                <option value="0" disabled selected>Select staff</option>
								                <option th:each="beneficiary : ${beneficiaries}" 
									                    th:value="${beneficiary.id}" 
									                    th:data-tipo="${beneficiary.tipo}"
									                    th:data-documento="${beneficiary.documento}"
									                    th:data-nombres="${beneficiary.nombres}"
									                    th:data-apellidos="${beneficiary.apellidos != null ? beneficiary.apellidos : ''}"
								                        th:text="${beneficiary.tipo +' =>'+ beneficiary.nombres +' '+ (beneficiary.apellidos != null ? beneficiary.apellidos : '') +' - '+beneficiary.documento}">
								                </option>
								     </select>                            	

                            	</div>
                            	<div class="col-1">
                            			  <div class="form-group">
		                                 <input type="hidden" class="form-control form-control-user" 
		       									id="inputIdBeneficiario" name="inputIdBeneficiario" placeholder="id beneficiario x">
		                                 <input type="hidden" class="form-control form-control-user" 
		       									id="inputBeneficiario" name="inputBeneficiario" placeholder="beneficiario x">	
		                             
                            	     <label for="btnAddBeneficiary" class="form-label"> &nbsp;&nbsp;</label>
			                         <button type="button" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales" 
			                         	data-toggle="modal" data-target="#beneficiaryModal"  onclick="showOverlay()">
			                               Add
			                         </button>
			                         </div>	                            	
                            	</div>                            	
                            </div>	
                            <div class="row">
                            	<div class="col-10">
			                        <div class="row-header-montos">
			                            <div class="col">
			                                <strong> Beneficiary type:</strong>
			                                <p class="p-header" id="beneficiarioTipo">Staff</p>
			                            </div>
			                            <div class="col">
			                                <strong> Identification Document:</strong>
 											<p class="p-header" id="beneficiarioDocumento">12345678</p> 
 			                            </div>
			                        </div>
			                        <div class="row-header-montos">
			                            <div class="col">
			                                <strong> Full Name:</strong>
 											<p class="p-header" id="beneficiarioNombre">Jhon Smith</p>
			                            </div>
			                            <div class="col">
			                                <strong> Company Name:</strong>
 											<p class="p-header" id="beneficiarioDocumento">----</p> 				                               
			                            </div>
			                        </div>
                           	
                            	</div>
                            	<div class="col-2">
	                            	<div class="form-check form-switch">
									  <input name="expenseDescargo" th:field="*{descargo}" class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
									  <label class="form-check-label" for="flexSwitchCheckDefault">Presents discharge?</label>
									</div>
                            	</div>                              	
                            </div>
                            <div class="row">
                            	<div class="col">
		                             <div class="row">
									      	<div class="col-6">
		                            		<div class="form-group">
					                              <label for="inputfechaInicial" class="form-label">Start Date</label>
					                              <input th:field="*{fechaInicio}" 
					                              		th:value="${#dates.format(fechaInicio, 'MM/dd/yyyy')}" 
					                              		type="date"  
					                              		class="form-control form-control-user"
					                                    id="inputfechaInicio" 
					                                    placeholder="MM/DD/YYYY" 
					                                    required 
                           								onchange="formatDate(this.value); checkFormaPago(); checkDates();">
                             	
			                               <!-- Elemento para mostrar la fecha formateada -->
												<p id="formattedDate"></p>
			                                </div> 
                            			</div>
                            			<div class="col-6">
			                                	<div class="form-group">
													 <label for="inputfechaFin" class="form-label">End Date</label>
					                                 <input th:field="*{fechaFin}" type="date" class="form-control form-control-user"
					                                           id="inputfechaFin" 
					                                           onchange="checkDates();"
					                                           required disabled>
					                            </div>      
                            			</div>
		                             </div>
                            	
                            	</div>
                            	<div class="col">
			                        <div class="form-group">
									 <label for="inputTiempo" class="form-label">Time</label>                            	
		                       		<input th:field="*{tiempo}" type="number" class="form-control form-control-user" 
		       								id="inputTiempo" name="inputTiempo" step="0.000001"  value="1" disabled>
                            		</div>
                            	</div>
                            </div>
                            <div class="row">
                            	<div class="col">
                            		<div class="row">
                            			<div class="col">
					                        <div class="form-group">
											 <label for="inputCantidad" class="form-label">Quantity</label>                            			
		                       				<input th:field="*{cantidad}" type="number"  class="form-control form-control-user" 
		       										id="inputCantidad" name="inputCantidad" step="0.01" oninput="calculateTotalMontoPagar()" onchange="calculateTotalMontoPagar()">
		       								</div>                            			
                            			</div>
                            			<div class="col">
					                        <div class="form-group">
											 <label for="inputPrecioUnitario" id="expensePrecioUnitarioMonto" class="form-label">Unit Cost </label>                            			
		                       				<input th:field="*{costoUnitario}"  type="number" class="form-control form-control-user" 
		       									id="inputPrecioUnitario" name="inputPrecioUnitario" step="0.01" oninput="calculateTotalMontoPagar()"  onchange="calculateTotalMontoPagar()" >                             			
											</div>
                            			</div>
                            		</div>
                            	</div>
                            	<div class="col">
					                    <div class="form-group">
									    <label for="inputMontoPaga" class="form-label">Total Amount to pay </label>                            			
		                       			<input th:field="*{montoTotal}"  type="text" class="form-control form-control-user" 
		       								id="inputMontoPagar" name="inputMontoPagar" step="0.01" disabled > 
		       							</div>	                             	
                            	</div>
                            </div>
                            <div class="row">
                            	<div class="col">
                            		<div class="form-group">
                                        <label for="inputpais" class="form-label">Country</label>
								        <SELECT th:field = "*{pais}"  class="form-control form-control-user"  data-show-subtext="true" data-live-search="true">
											<OPTION th:EACH= "pais : ${paises}" 
													th:VALUE = "${pais.nombre}" 
													th:TEXT = "${pais.nombre +' - (Money Currency -'+ pais.divisa+')' }" >										 
											</OPTION >		 
										</SELECT>  
									</div>                            	
                            	</div>
                            	<div class="col">
                            		<div class="row">
                            			<div class="col-6">
			                               <div class="form-group">
												<label for="inputfecha" class="form-label">Date Transfer</label>
					                            <input th:field="*{fecha}" type="date" class="form-control form-control-user"
					                                           id="inputfecha" onchange="formatDate(this.value)" required>
					                       </div>                             			
                            			</div>
                            			<div class="col-6">
				                            <div class="form-group">
				                                <label for="inputaccount" class="form-label">Type of Expense</label>
													<select th:field="*{tipoTransferencia}" class="form-control form-control-user" id="inputTipoTransferencia" name="inputTipoTransferencia" required>
													    <option value="" th:if="${expense.id == null}">Select type</option>
													    <option value="TRANSFER" th:selected="${expense.tipoTransferencia == 'TRANSFER'}">Transfer</option>
													    <option value="CASH" th:selected="${expense.tipoTransferencia == 'CASH'}">Cash</option>
													</select>
				                             </div>                             			
                            			</div>
                            		</div>
                            	</div>                            	
                            </div>
                            <div class="row">
                            	<div class="col">
                            		<div class="row">
                            			<div class="col">
		                            		<div class="form-group">
											 <label for="inputFee" class="form-label">Fee</label>                            	
				                       		<input th:field="*{fee}" type="number" class="form-control form-control-user" 
				       								id="inputFee" name="inputFee" step="0.01" oninput="calculateTotalLCU()" onchange="calculateTotalLCU()" >
		                            		</div> 
                            			</div>
                            			<div class="col">
		                            		<div class="form-group">
											 <label for="inputCambioMoneda" class="form-label">Exchange Rate</label>                            	
				                       		<input th:field="*{cambio}"  type="number" class="form-control form-control-user" 
				       								id="inputCambioMoneda" name="inputCambioMoneda" step="0.000001" oninput="calculateTotalLCU()" onchange="calculateTotalLCU()"  >
		                            		</div> 
                            			</div>
                            		</div>
                           	
                            	</div>
                            	<div class="col">
			                        <div class="form-group">
									 <label for="inputTotalLCU" class="form-label">Amount in local Currency</label>                            	
		                       		<input th:field="*{totalLCU}" type="text" class="form-control form-control-user" 
		       								id="inputTotalLCU" name="inputTotalLCU" step="0.01" disabled>
                            		</div>                            	
                            	</div>
                            </div>
 							<!-- Mostrar mensaje de error si existe -->
                            <div th:if="${error}" class="alert alert-danger" role="alert" style="color: red;">
                                <p th:text="${error}"></p>
                            </div>
                             <button id="btnExpense" type="submit" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales" >
                                SAVE EXPENSE
                             </button>
							<div class="text-center">
 								<a class="medium" th:href="@{/ejecucion/registro-ejecucion/{id}(id=${project.id})}">GO BACK</a>
                           </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Modal para registrar cargo/escala -->
<div class="modal fade" id="cargoModal" tabindex="-1" role="dialog" aria-labelledby="cargoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cargoModalLabel">Register Position</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formEscala" class="user" th:action="@{/scales/guardar-cargo/{idp}(idp=${project.id})}" th:method="post" th:object="${scale}">
          <div class="row">
            <div class="col">
              <div class="form-group">
                  <!-- Campo oculto para el ID -->
    			<input type="hidden" th:field="*{id}" th:value="0">
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputNombreCargo" class="form-label">Name</label>
                <input th:field="*{nombre}" type="text" class="form-control form-control-user" id="inputNombreCargo" placeholder="Enter name" required>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputSalarioCargo" class="form-label">Salary</label>
                <input th:field="*{salario}" type="number" class="form-control form-control-user" id="inputSalarioCargo" min="0"  step="0.01" placeholder="0" required>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal para registrar beneficiario -->
<div class="modal fade" id="beneficiaryModal" tabindex="-1" role="dialog" aria-labelledby="beneficiaryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="beneficiaryModalLabel">Register Beneficiary</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formBeneficiario" class="user" th:action="@{/beneficiarios/guardar-beneficiario/{idp}(idp=${project.id})}" th:method="post" th:object="${beneficiary}">
          <div class="row">
            <div class="col">
              <div class="form-group">
                  <!-- Campo oculto para el ID -->
    			<input type="hidden" th:field="*{id}" th:value="0">
                <label for="inputtipo" class="form-label">Beneficiary Type</label>
                <select th:field="*{tipo}" class="form-control form-control-user" id="inputtipo" required>
                  <option value="" th:if="${beneficiary.id == 0}">Select type</option>
                  <option value="Natural Person" th:selected="${beneficiary.tipo == 'Natural Person'}">Natural Person</option>
                  <option value="Legal Entity" th:selected="${beneficiary.tipo == 'Legal Entity'}">Legal Entity</option>
                  <option value="Staff" th:selected="${beneficiary.tipo == 'Staff'}">Staff</option>
                </select>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputdocumento" class="form-label">Identification Document</label>
                <input th:field="*{documento}" type="text" class="form-control form-control-user" id="inputdocumento" placeholder="Document Number" required>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputnombres" class="form-label">First name</label>
                <input th:field="*{nombres}" type="text" class="form-control form-control-user" id="inputnombre" placeholder="Enter first name" required>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputapellidos" class="form-label">Last Name</label>
                <input th:field="*{apellidos}" type="text" class="form-control form-control-user" id="inputapellidos" placeholder="Enter Last name" required>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputrazonSocial" class="form-label">Company Name</label>
                <input th:field="*{razonSocial}" type="text" class="form-control form-control-user" id="inputrazonSocial" placeholder="Company name if applicable">
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputpaisProcedencia" class="form-label">Country origin</label>
                <select th:field="*{paisProcedencia}" class="form-control form-control-user" id="inputpaisProcedencia" data-show-subtext="true" data-live-search="true" required>
                  <option value="na" disabled selected>Select country</option>
                  <option th:each="paiss : ${paisesBeneficiary}"
                  		  th:value="${paiss.nombre}" 
                  		  th:text="${paiss.nombre}">
                  </option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputemail" class="form-label">Email</label>
                <input th:field="*{email}" type="email" class="form-control form-control-user" id="inputemail" placeholder="example@gmail.com" required>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputtelefonoContacto" class="form-label">Contact phone</label>
                <input th:field="*{telefonoContacto}" type="text" class="form-control form-control-user" id="inputtelefonoContacto" placeholder="Contact phone">
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save Beneficiary</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
<!-- Footer -->
   <footer th:replace="design/footerBar :: footerbar"></footer>
<!-- End of Footer -->
<div th:replace="design/script :: scripts"></div>

<script>
// Función para actualizar 'inputCargoItem' con el valor de 'inputItem' o 'selectCargo'
function updateCargoItem(value) {
    document.getElementById("inputCargoItem").value = value;
}

    function toggleFields(selectElement) {
        // Obtener el valor de `nombreClase` del atributo data-nombreClase del option seleccionado
        const selectedOption = selectElement.options[selectElement.selectedIndex];
        const nombreClase = selectedOption.getAttribute("data-nombreClase");

        const expenseObjetoPuestoLabel = document.getElementById("expenseObjetoPuesto");
        const expenseCargoItemLabel = document.getElementById("expenseCargoItem");
        const expensePrecioUnitarioMontoLabel = document.getElementById("expensePrecioUnitarioMonto");
        const inputCargoItem = document.getElementById("inputCargoItem");
        const inputItem = document.getElementById("inputItem");
        const selectCargo = document.getElementById("selectCargo");
        const btnAddCargo = document.getElementById("btnAddCargo");

        if (nombreClase === "Staff") {
            expenseObjetoPuestoLabel.textContent = "Job Position";
            expenseCargoItemLabel.textContent = "Scale";
            expensePrecioUnitarioMontoLabel.textContent = "Amount to pay";
            selectCargo.style.display = "block";
            inputItem.style.display = "none";
            btnAddCargo.style.display = "block";
        } else {
            expenseObjetoPuestoLabel.textContent = "Object";
            expenseCargoItemLabel.textContent = "Item";
            expensePrecioUnitarioMontoLabel.textContent = "Unit Cost";
            selectCargo.style.display = "none";
            inputItem.style.display = "block";
            btnAddCargo.style.display = "none";
        }
        // Reiniciar 'inputCargoItem' cuando cambia el campo activo
        inputCargoItem.value = "";
    }
</script>

<script>

// Llama a esta función para actualizar el valor antes de enviar el formulario
function prepareMonto(elementId) {
	alert(elementId);
    const element = document.getElementById(elementId);
    element.value = element.value.replace(/,/g, ''); // Elimina comas antes de enviar al servidor
}
</script>
    <script>
        // Función para prevenir el envío del formulario con la tecla Enter
        function disableEnterKey(event) {
            if (event.key === "Enter") {
                event.preventDefault(); // Previene la acción predeterminada (enviar el formulario)
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById("miFormulario"); // Reemplaza con el ID de tu formulario

            form.addEventListener("submit", function(event) {
                prepareMonto('inputMontoPagar');
                prepareMonto('inputTotalLCU');
                showOverlay();
                // Si quieres que el formulario siga enviándose, no uses preventDefault aquí
            });
        });

    </script>
<script>
function loadBeneficiaryData() {
    var select = document.getElementById("beneficiarioE");
    var selectedOption = select.options[select.selectedIndex];

    // Obtener los datos del beneficiario seleccionado
    var tipo = selectedOption.getAttribute("data-tipo");
    var documento = selectedOption.getAttribute("data-documento");
    var nombres = selectedOption.getAttribute("data-nombres");
    var apellidos = selectedOption.getAttribute("data-apellidos");

    // Actualizar los campos de entrada
    document.getElementById("inputIdBeneficiario").value = selectedOption.value;
    document.getElementById("inputBeneficiario").value = nombres + ' ' + apellidos;

    // Actualizar las etiquetas <p>
    document.getElementById("beneficiarioTipo").textContent = tipo;
    document.getElementById("beneficiarioDocumento").textContent = documento;
    document.getElementById("beneficiarioNombre").textContent = nombres + ' ' + apellidos;
}
</script>   
<script>
function openModal() {
    // Limpiar el campo ID para crear un nuevo registro
    document.getElementById("inputId").value = 0;
    
    // Limpiar otros campos del formulario si es necesario
    document.getElementById("inputdocumento").value = "";
    // Limpiar otros campos del formulario...

    // Mostrar el modal
    $('#myModal').modal('show');
}

</script> 
<script type='text/javascript'>
$(function(){
    $(document).bind("contextmenu",function(e){
        return false;
    });
});
</script>
<script>
function toggleFechaFin(selectElement) {
    // Obtener el valor seleccionado
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    const formaPago = selectedOption.text.split(' -> ')[1]; // Asumiendo que 'formaPago' está después de '->'

    // Obtener el campo de fechaFin y tiempo
    const fechaFinInput = document.getElementById('inputfechaFin'); 
    const tiempoInput = document.getElementById('inputTiempo');

    // Verificar si formaPago es 'pago único'
    if (formaPago === 'single payment') {
        fechaFinInput.disabled = true; // Deshabilitar
        fechaFinInput.value = ''; // Limpiar valor si está deshabilitado
        //tiempoInput.disabled = true;
        tiempoInput.value = '1';
        
        
    } else {
        fechaFinInput.disabled = false; // Habilitar
        //tiempoInput.disabled = false;
    }
}
</script>
<script>
    function checkFormaPago() {
        const formaPago = document.querySelector('input[name="formaPago"]:checked').value; // Ajustar selector según tu estructura de formulario
        const inputTiempo = document.getElementById('inputTiempo');
        const inputFechaFin = document.getElementById('inputfechaFin');

        if (formaPago === 'single pay') {
            inputTiempo.value = 1;  // Establecer tiempo a 1
            inputTiempo.disabled = true;
            inputFechaFin.disabled = true; // Desactivar fechaFin
            inputFechaFin.value = ''; // Limpiar fechaFin
        } else {
            inputTiempo.disabled = false; // Habilitar inputTiempo
            inputFechaFin.disabled = false; // Habilitar fechaFin
        }
    }
    
    
/*
    function checkDates() {
        const fechaInicioStr = document.getElementById('inputfechaInicio').value;
        const fechaFinStr = document.getElementById('inputfechaFin').value;

        if (fechaInicioStr && fechaFinStr) {
            // Convertir las cadenas de fecha a objetos Date
            const fechaInicio = new Date(fechaInicioStr);
            const fechaFin = new Date(fechaFinStr);
            alert(fechaInicio+"---"+fechaFin);
            // Verificar si las fechas son válidas
            if (isNaN(fechaInicio.getTime()) || isNaN(fechaFin.getTime())) {
                alert("Please, enter date valid.");
                return;
            }

            // Llamar a tu función para calcular inputTiempo
            calculateInputTiempo(fechaInicio, fechaFin);
        } else {
            alert("Please, complete both dates.");
        }
    }
    */
    function checkDates() {
        const fechaInicioStr = document.getElementById('inputfechaInicio').value;
        const fechaFinStr = document.getElementById('inputfechaFin').value;

        if (fechaInicioStr && fechaFinStr) {
            // Convertir las cadenas de fecha a objetos Date usando Date.UTC
            const [yearInicio, monthInicio, dayInicio] = fechaInicioStr.split("-");
            const [yearFin, monthFin, dayFin] = fechaFinStr.split("-");

            // Crear fechas en UTC (los meses son 0-indexed)
            const fechaInicio = new Date(Date.UTC(yearInicio, monthInicio - 1, dayInicio));
            const fechaFin = new Date(Date.UTC(yearFin, monthFin - 1, dayFin));
            alert(fechaInicio+"---"+fechaFin);
            // Verificar si las fechas son válidas
            if (isNaN(fechaInicio.getTime()) || isNaN(fechaFin.getTime())) {
                alert("Por favor, ingresa fechas válidas.");
                return;
            }

            // Llamar a tu función para calcular inputTiempo
            calculateInputTiempo(fechaInicio, fechaFin);
        } else {
            alert("Por favor, completa ambas fechas.");
        }
    }

    function calculateInputTiempo(fechaInicial, fechaFinal) {
        // Extraer día, mes y año de las fechas
        //alert(fechaInicial+'jo'+fechaFinal);
        const diaInicial = fechaInicial.getDate();
        const mesInicial = fechaInicial.getMonth() + 1; // Los meses en JavaScript son 0-indexed
        const anoInicial = fechaInicial.getFullYear();
        
        const diaFinal = fechaFinal.getDate();
        const mesFinal = fechaFinal.getMonth() + 1; // Los meses en JavaScript son 0-indexed
        const anoFinal = fechaFinal.getFullYear();
        
        //alert("DIA "+diaInicial);
        
        let dias;

        // Ajuste para febrero y el último día del mes
        if ((mesFinal === 2 && diaFinal >= 28) || (mesFinal !== 2 && diaFinal >= 30)) {
            diaFinal = 30;
            
        }
        // Ajustar si el día final es menor que el día inicial
        if (diaFinal < diaInicial) {
            diaFinal += 30;
            mesFinal -= 1;
            alert("Ajustar si el día final es menor que el día inicial");
        }
        // Ajustar si el mes final es menor que el mes inicial
        if (mesFinal < mesInicial) {
            mesFinal += 12;
            anoFinal -= 1;
            alert("Ajustar si el mes final es menor que el mes inicial");
        }
    // Calcular el total de días
        dias = (diaFinal + 1 - diaInicial) +
               ((mesFinal - mesInicial) * 30) +
               ((anoFinal - anoInicial) * 360);

        //return dias;
    alert(dias);
    document.getElementById('inputTiempo').value = dias; // Establece el valor calculado
    }
    /*function calculateInputTiempo(fechaInicio, fechaFin) {
    	
    	alert(fechaInicio+'***'+ fechaFin);
        $.ajax({
            url: '/calculate/'+fechaInicio+'/'+fechaFin, // Asegúrate de que esta URL sea correcta
            type: 'POST',
            data:formData,
            success: function(data) {
                // Aquí data debería ser el número de días calculados
                
       		alert(data);
    		document.getElementById('inputTiempo').value = data; // Establece el valor calculado
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error calculating time:', textStatus, errorThrown);
                alert('Error calculating the time between dates. Please try again. '+error);
            }
        });
    }*/
    /*
    async function calculateInputTiempo(fechaInicio, fechaFin) {
        try {
            const response = await fetch('/api/calculate', { // Ajusta la ruta según tu endpoint
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    fecha_inicial: fechaInicio,
                    fecha_final: fechaFin
                }),
            });

            if (!response.ok) throw new Error('Network response was not ok');

            const data = await response.json();

            // Suponiendo que data regresa el tiempo que necesitas
            document.getElementById('inputTiempo').value = data; // Establecer el valor de tiempo calculado
        } catch (error) {
            console.error(error);
            alert('Error calculating the time between dates. Please try again.'+error);
        }
    */
/*
    async function calculateInputTiempo(fechaInicio, fechaFin) {
    	
    	alert(fechaInicio+"    "+fechaFin);
        try {
            const { data, error } = await supabase
                .rpc('fn_obtener_dias_por_rango_fechas', {
                    fecha_inicial: fechaInicio,
                    fecha_final: fechaFin
                });

            if (error) throw error;

            // Suponiendo que data retorna el tiempo que necesitas
            document.getElementById('inputTiempo').value = data; // Establecer el valor de tiempo calculado
        } catch (error) {
            console.error(error);
            alert('Error calculating the time between dates. Please try again.');
        }
    }*/
</script>
<script>
function calculateTotalMontoPagar() {
    const cantidad = parseFloat(document.getElementById("inputCantidad").value) || 0;
    const precioUnitario = parseFloat(document.getElementById("inputPrecioUnitario").value) || 0;
    const tiempo = parseFloat(document.getElementById("inputTiempo").value) || 1;
        // Calcular montos
        const montoTotalPagar = (cantidad * precioUnitario) / tiempo;

        const formateador = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        // Formatear monto solo para mostrarlo
        document.getElementById("inputMontoPagar").value = formateador.format(montoTotalPagar);

        // Guardar valor sin formato en una propiedad personalizada para futuros cálculos
        //document.getElementById("inputMontoPagar").dataset.rawValue = montoTotalPagar;

}

function calculateTotalLCU() {
    const fee = parseFloat(document.getElementById("inputFee").value) || 0;
    const cambioMoneda = parseFloat(document.getElementById("inputCambioMoneda").value) || 0;

        // Calcular montos
        const montoLCU = (fee * cambioMoneda);

        const formateador = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        //const numeroFormateado = formateador.format(montoTotalPagar);
        document.getElementById("inputTotalLCU").value = formateador.format(montoLCU);
        // Guardar valor sin formato en una propiedad personalizada para futuros cálculos
        //document.getElementById("inputTotalLCU").dataset.rawValue = montoTotalPagar;
}
</script>
</body>
</html>








