<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head th:replace="design/header :: head">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body class="bg-sistemasIntegrales" onload="hideMessage()">
    <!-- Mostrar el mensaje si estÃ¡ presente -->
    <div th:if="${message}" id="notificationMessage"
        th:classappend="${messageType == 'success'} ? 'alert alert-success' : 'alert alert-danger'"
        style="padding: 10px; margin-bottom: 15px; border-radius: 5px;">
        <span th:text="${message}"></span>
    </div>
<div class="container" style="width: 80%;">
    <div class="card o-hidden border-0 shadow-lg my-2">
        <div class="card-body p-0">
            <!-- Nested Row within Card Body -->
            <div>
                <div>
                    <div class="p-3">
                    	<div class="box box-primary">
	 						<div class="box-header with-border">
							<h6>PROJECT DETAILS</h6>
							</div>
							<div class="box-body">
								<div class="row-header-max">
									<div class="col-6">
										<div class="row-header">
											<div class="col-7">
												<strong><i class="fa fa-book margin-r-5"></i> Project Name</strong>
												<p class="p-header"  th:text="${project.nombre}">PROJECT IDB	</p>
											</div>
											<div class="col-5">
												<strong>Country</strong>
												<p  class="p-header"  th:text="${project.pais}">Chile</p>
											
											</div>
										</div>
										<div class="row-header">
											<div class="col">
												<strong>Dates</strong>
												<p class="p-header"  th:text="${#dates.format(project.fechaInicial, 'MM/dd/yy') + ' - ' + #dates.format(project.fechaFin, 'MM/dd/yy')}"></p>

											</div>
											<div class="col">
												<strong>Financier</strong>
												<p class="p-header"  th:text="${project.cliente}"></p>

											</div>											
										</div>
									</div>
									<div class="col-6">
										<div class="row-header-montos">
											<div class="col">
												<strong> Contract Amount (USD)</strong>
												<p class="p-header"  th:text="${#numbers.formatDecimal(project.montoContrato, 1, 'COMMA', 2, 'POINT')}">$100,000.00</p>
											</div>
										</div>	
										<div class="row-header-montos">
											<div class="col-6">
												<strong>Recurring Amount (USD)&nbsp;&nbsp;
														<span th:text="${#numbers.formatDecimal(project.porcentajeRecurrente, 1, 'COMMA', 2, 'POINT')}+ '%'">0.00%</span>
												
												</strong>
												<p class="p-header"  th:text="${#numbers.formatDecimal(project.montoRecurrente, 1, 'COMMA', 2, 'POINT')}">$20,000.00</p>
											</div>
											<div class="col-6">
												<strong>Non-Recurring Amount (USD)</strong>
												<p  class="p-header" th:text="${#numbers.formatDecimal(project.montoNoRecurrente, 1, 'COMMA', 2, 'POINT')}">$80,000.00</p>
											</div>								
										</div>	
									</div>
								</div>
								<hr>
							</div>
							
						</div>
                        <div class="text-center">
                            <h2 th:if="${expense.id == null}">Expense Register</h2>
                            <h2 th:if="${expense.id != null and expense.id != 0}">Expense Edit</h2>
                        </div>
                        <form id="miFormulario"  class="user" th:action="@{/expenses/guardar-egreso}" th:method="post" th:object="${expense}" enctype="multipart/form-data">
                            <input type="hidden" th:if="${expense.id!=0}"  th:field="*{id}" th:value="${expense.id}">
                           
                            <input type="hidden" th:value="${project.id}" id="inputproyectoId" name="inputproyectoId">
                            
                            <div class="row">
                            	<div class="col-6">
                            		<div class="row">
                            			<div class="col-8">
				                            <div class="form-group">
				                                <label for="inputaccount" class="form-label">Project Phases</label>
													<select th:field="*{proyectoFase}" class="form-control form-control-user"  required>
													    <option value="" th:if="${expense.id == null}" selected >Select phase</option>
													    <option th:each="faseproyecto : ${fasesProyecto}" th:value="${faseproyecto.id}"
													    		th:text="${faseproyecto.fase.nombre+ ' - (' + #numbers.formatDecimal(faseproyecto.presupuesto, 1, 'COMMA', 2, 'POINT')+' USD)'}" ></option>
													    
													</select>
				                             </div>                               			
                            			</div>
                            			<div class="col-4">
				                            <div class="form-group">
				                                <label for="inputtipo" class="form-label">Type of Expense</label>
													<select th:field="*{tipo}" class="form-control form-control-user" id="inputtipo" disabled >
													    
													    <option value="Non-Recurring" selected >Non-Recurring</option> <!-- Default selected option -->
													    <option value="Recurring" >Recurring</option>
													    
													</select>
				                             </div>                               			
                            			</div>
                            		</div>
                         	
                            	</div>  
                            	<div class="col-6">
                            		<div class="row">
                            			<div class="col-8">
				                            <div class="form-group">
				                                <label for="inputClassification" class="form-label">Classification of Expense</label>
				                                <select th:field="*{clasificacionEgreso}" class="form-control  form-control-user" onchange="toggleFields(this);"
				                               			 required>
				                                	<option value="" th:if="${expense.id == null}"  selected  >Select classification</option>
				                                    <option th:each="classification : ${expenditureClassifications}" 
				                                    		th:value="${classification.id}"
				                                            th:data-nombreClase="${classification.nombreClase}"
				                                            
				                                            th:text="${classification.nombreClase}"
				                                            th:selected="${classification.id == clasificacionEgreso}"></option>
				                                </select>
				                                <input type="hidden" id="inputPago" name="inputPago">
											</div>                            			
                            			</div>
                            			 
                            			<div class="col-4">
		                            		<div class="form-group">
				                                <label for="inputtipo" class="form-label">&nbsp;&nbsp;</label>
				                                	
														<select  class="form-control form-control-user" id="inputPago" required  onchange="toggleFechaFin(this)">
														 <option value="" th:if="${expense.id == null}" selected disabled>Select</option>
														 <option th:each="method : ${paymentMethod}"
														 		 th:value ="${method.descripcion}"
														 		 th:data-formaPago ="${method.descripcion}"
														 		 th:text="${method.descripcion}">
														 </option>
																    
														</select>
														
				                             </div>                              			
                            			</div>                           			
                            		</div>			
                          	
                            	</div>                            	                          	
                            </div>
                            <div class="row">
                            	<div class="col-6">
		                             <div class="form-group">
		                             	 <label for="inputObjetoPuesto" id="expenseObjetoPuesto" class="form-label">Objeto</label>
		                                 <input th:field="*{objeto}" type="text" class="form-control form-control-user" 
		       									id="inputObjetoPuesto" name="inputObjetoPuesto" placeholder="Enter object or position in the company">
		                             </div>
                            	</div>
                            	<div class="col-6">
                            		<div class="row">
                            			<div class="col-9">
				                             <div class="form-group">
				                             	 <label for="inputCargoItem" id="expenseCargoItem" class="form-label">Item</label>
				                                 <input type="text" class="form-control form-control-user" 
				       									id="inputItem" name="inputItem" placeholder="Enter item"  style="display: none;"
				       									oninput="updateCargoItem(this.value)">
				       									<!-- en caso de item, deberia carga un combo-->
				                                <select id= "selectCargo" name= "selectCargo" class="form-control  form-control-user" 
				                                	  style="display: none;"  onchange="updateCargoItem(this.options[this.selectedIndex].value)">
				                                	<option value="" disabled selected>Select expense</option>
				                                    <option th:each="escala : ${escalas}" 
				                                    		th:value="${escala.nombre}"
				                                            th:text="${escala.nombre +' - (' + #numbers.formatDecimal(escala.salario, 1, 'COMMA', 2, 'POINT')+' USD)'}" ></option>
				                                </select>	 	  
				                                 <input  th:field="*{cargoItem}" type="hidden" class="form-control form-control-user" 
				       									id="inputCargoItem" name="inputCargoItem" required>     									
				                             </div>                            			
                            			</div>
		                            	<div class="col-3">
		                            		<label for="btnAddCargo" class="form-label"> &nbsp;&nbsp;</label>
					                         <button type="button" id ="btnAddCargo" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales" 
					                         	data-toggle="modal" data-target="#cargoModal"  onclick="showOverlay()" style="display: none;">
					                               Add
					                         </button>	                            	
		                            	</div> 
                            		</div>

                            	</div>                            	
                            </div>		
                            <div class="row">
                            	<div class="col-11">
                            		<label for="beneficiarioE" class="form-label">Beneficiary </label>
 								    <select  th:field="*{beneficiario}" id="beneficiarioE" name="beneficiarioE" class="form-control form-control-user" 
 								    		data-show-subtext="true" data-live-search="true" onchange="loadBeneficiaryData()">
								                <option value="0" disabled selected>Select staff</option>
								                <option th:each="beneficiary : ${beneficiaries}" 
									                    th:value="${beneficiary.id}" 
									                    th:data-tipo="${beneficiary.tipo}"
									                    th:data-documento="${beneficiary.documento}"
									                    th:data-nombres="${beneficiary.nombres}"
									                    th:data-apellidos="${beneficiary.apellidos != null ? beneficiary.apellidos : ''}"
								                        th:text="${beneficiary.tipo +' =>'+ beneficiary.nombres +' '+ (beneficiary.apellidos != null ? beneficiary.apellidos : '') +' - '+beneficiary.documento}">
								                </option>
								     </select>                            	

                            	</div>
                            	<div class="col-1">
                            		<div class="form-group">
			                             <input type="hidden" class="form-control form-control-user" 
			       									id="inputIdBeneficiario" name="inputIdBeneficiario" placeholder="id beneficiario x">
			                             <input type="hidden" class="form-control form-control-user" 
			       									id="inputBeneficiario" name="inputBeneficiario" placeholder="beneficiario x">	
			                             
	                            	     <label for="btnAddBeneficiary" class="form-label"> &nbsp;&nbsp;</label>
				                         <button type="button" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales" 
				                         	data-toggle="modal" data-target="#beneficiaryModal"  onclick="showOverlay()">
				                               Add
				                         </button>
			                         </div>	                            	
                            	</div>                            	
                            </div>	
                            <div class="row">
                            	<div class="col-10">
			                        <div class="row-header-montos">
			                            <div class="col">
			                                <strong> Beneficiary type:</strong>
			                                <p class="p-header" id="beneficiarioTipo">---</p>
			                            </div>
			                            <div class="col">
			                                <strong> Identification Document:</strong>
 											<p class="p-header" id="beneficiarioDocumento">---</p> 
 			                            </div>
			                        </div>
			                        <div class="row-header-montos">
			                            <div class="col">
			                                <strong> Full Name:</strong>
 											<p class="p-header" id="beneficiarioNombre">---</p>
			                            </div>
			                            <div class="col">
			                                <strong> Company Name:</strong>
 											<p class="p-header" id="beneficiarioDocumento">---</p> 				                               
			                            </div>
			                        </div>
                           	
                            	</div>
                            	<div class="col-2">
	                            	<div class="form-check form-switch">
									  <input name="expenseDescargo" th:field="*{descargo}" class="form-check-input" type="checkbox" id="flexSwitchCheckDefault">
									  <label class="form-check-label" for="flexSwitchCheckDefault">Presents discharge?</label>
									</div>
                            	</div>                              	
                            </div>
                            <div class="row">
                            	<div class="col-7">
		                             <div class="row">
									    <div class="col-4">
		                            		<div class="form-group">
					                              <label for="inputfechaInicial" class="form-label">Start Date</label>
					                              <input th:field="*{fechaInicio}" 
					                              		th:value="${#dates.format(fechaInicio, 'MM/dd/yyyy')}" 
					                              		type="date"  
					                              		class="form-control form-control-user"
					                                    id="inputfechaInicio" 
					                                    placeholder="MM/DD/YYYY" 
					                                    required 
                           								onchange=" checkDates()">
                             	
			                               <!-- Elemento para mostrar la fecha formateada -->
												<p id="formattedDate"></p>
			                                </div> 
                            			</div>
                            			<div class="col-4">
			                                	<div class="form-group">
													 <label for="inputfechaFin" class="form-label">End Date</label>
					                                 <input th:field="*{fechaFin}" type="date" class="form-control form-control-user"
					                                           id="inputfechaFin" 
					                                           onchange ="checkDates()"
					                                            readonly>
					                            </div>      
                            			</div>
		                            	<div class="col-4">
					                        <div class="form-group">
											 <label for="inputTiempo" class="form-label">Time</label>                            	
				                       		<input th:field="*{tiempo}" type="number" class="form-control form-control-user" 
				       								id="inputTiempo" name="inputTiempo" step="0.000001"  readonly>
		                            		</div>
		                            	</div>
		                             </div>
                            		 <div class="row">
                            			<div class="col-4">
					                        <div class="form-group">
											 <label for="inputCantidad" class="form-label">Quantity</label>                            			
		                       				<input th:field="*{cantidad}" type="number"  class="form-control form-control-user" 
		       										id="inputCantidad" name="inputCantidad" step="0.01" oninput="calculateTotalMontoPagar()" onchange="calculateTotalMontoPagar()">
		       								</div>                            			
                            			</div>
                            			<div class="col-4">
					                        <div class="form-group">
											 <label for="inputPrecioUnitario" id="expensePrecioUnitarioMonto" class="form-label">Unit Cost (USD)</label>                            			
		                       				<input th:field="*{costoUnitario}"  type="number" class="form-control form-control-user" 
		       									id="inputPrecioUnitario" name="inputPrecioUnitario" step="0.01" oninput="calculateTotalMontoPagar()"  onchange="calculateTotalMontoPagar()" >                             			
											</div>
                            			</div>
		                            	<div class="col-4">
							                    <div class="form-group">
											    <label for="inputMontoPaga" class="form-label">Total (USD) </label>                            			
				                       			<input th:field="*{montoTotal}"  type="text" class="form-control form-control-user" 
				       								id="inputMontoPagar" name="inputMontoPagar" step="0.01" 
				       								placeholder="0.00" readonly > 
				       							</div>	                             	
		                            	</div>                            			
                            		 </div>  
	                            		<div class="row">
	                            			<div class="col-4">
				                               <div class="form-group">
													<label for="inputfecha" class="form-label">Date Transfer</label>
						                            <input th:field="*{fecha}" type="date" class="form-control form-control-user"
						                                           id="inputfecha" onchange="formatDate(this.value)" required>
						                       </div>                             			
	                            			</div>
	                            			<div class="col-4">
					                            <div class="form-group">
					                                <label for="inputaccount" class="form-label">Payment type</label>
														<select th:field="*{tipoTransferencia}" class="form-control form-control-user" id="inputTipoTransferencia" name="inputTipoTransferencia" required>
														    <option value="" th:if="${expense.id == null}">Select type</option>
														    <option value="TRANSFER" th:selected="${expense.tipoTransferencia == 'TRANSFER'}">Transfer</option>
														    <option value="CASH" th:selected="${expense.tipoTransferencia == 'CASH'}">Cash</option>
														</select>
					                             </div>                             			
	                            			</div>	  
	                            			<div class="col-4">
	                            				<div class="form-group">
												 <label for="inputFee" class="form-label">Fee</label>                            	
					                       		<input th:field="*{fee}" type="number" class="form-control form-control-user" 
					       								id="inputFee" name="inputFee" step="0.01" oninput="calculateTotalLCU()" onchange="calculateTotalLCU()" >
			                            		</div>  
			                            	</div>                        		
	                            		</div>                            		 
									<div class="row">
									    <div class="col-11">
									        <label for="inputAttach" class="form-label">Attach</label><br>
									        <input th:field="*{attach}" type="text" class="form-control form-control-user" id="inputAttach" name="inputAttach" readonly>
									    </div>
									    <div class="col-1">
									        <label for="inputAttach" class="form-label">  &nbsp;&nbsp;</label>
									        <input type="file" id="fileInput" name ="file" style="display:none;" />
									        <button id="btnAttach" type="button" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales">
									            Add
									        </button>
									    </div>
									</div>

                            	</div>
                            	<div class="col-5" style="background-color: rgb(245,245,245);">

	                            		<div class="row">
		                            		<div class="col">
		                            			<div class="form-group">
			                                        <label for="inputpais" class="form-label">Country</label>
											        <SELECT th:field = "*{pais}"  class="form-control form-control-user"  data-show-subtext="true" data-live-search="true">
														<OPTION th:EACH= "pais : ${paises}" 
																th:VALUE = "${pais.id}" 
																th:TEXT = "${pais.nombre}" >										 
														</OPTION >		 
													</SELECT>  
												</div> 	
		                            		</div>
	                            		</div>

	                            		<div class="row">
	                            			<div class="col-6">
			                                        <label for="inputpais" class="form-label">Divisa</label>
											        <SELECT   class="form-control form-control-user"  data-show-subtext="true" data-live-search="true">
														<OPTION th:EACH= "pais : ${paises}" 
																th:VALUE = "${pais.id}" 
																th:TEXT = "${pais.divisa}" >										 
														</OPTION >		 
													</SELECT>  
	                            			</div>
	                            			<div class="col-6">
			                            		<div class="form-group">
												 <label for="inputCambioMoneda" class="form-label">Exchange Rate</label>                            	
					                       		<input th:field="*{cambio}"  type="number" class="form-control form-control-user" 
					       								id="inputCambioMoneda" name="inputCambioMoneda" step="0.000001" oninput="calculateTotalLCU()" onchange="calculateTotalLCU()"  >
			                            		</div> 
	                            			</div>
	                            		</div>	
	                            		<div class="row">
			                            	<div class="col">
						                        <div class="form-group">
												 <label for="inputTotalLCU" class="form-label">Amount in local Currency</label>                            	
					                       		<input th:field="*{totalLCU}" type="text" class="form-control form-control-user" 
					       								id="inputTotalLCU" name="inputTotalLCU" step="0.01" 
					       								placeholder="0.00" readonly>
			                            		</div>                            	
			                            	</div>                            		
	                            		</div>

                            	</div>
                            </div>

 							<!-- Mostrar mensaje de error si existe -->
                            <div th:if="${error}" class="alert alert-danger" role="alert" style="color: red;">
                                <p th:text="${error}"></p>
                            </div>
                             <button id="btnExpense" type="submit" class="btn btn-outline-info text-sistemasIntegralesBtn custom-hover-sistemasIntegrales"
                              		onclick="prepareMonto('inputMontoPagar'); prepareMonto('inputTotalLCU'); showOverlay(); " >
                                SAVE EXPENSE
                             </button>
							<div class="text-center">
 								<a class="medium" th:href="@{/ejecucion/registro-ejecucion/{id}(id=${project.id})}">GO BACK</a>
                           </div>
                        </form>

                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
<!-- Modal para registrar cargo/escala -->
<div class="modal fade" id="cargoModal" tabindex="-1" role="dialog" aria-labelledby="cargoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cargoModalLabel">Register Position</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formEscala" class="user" th:action="@{/scales/guardar-cargo/{idp}(idp=${project.id})}" th:method="post" th:object="${scale}">
          <div class="row">
            <div class="col">
              <div class="form-group">
                  <!-- Campo oculto para el ID -->
    			<input type="hidden" th:field="*{id}" th:value="0">
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputNombreCargo" class="form-label">Name</label>
                <input th:field="*{nombre}" type="text" class="form-control form-control-user" id="inputNombreCargo" placeholder="Enter name" required>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputSalarioCargo" class="form-label">Salary</label>
                <input th:field="*{salario}" type="number" class="form-control form-control-user" id="inputSalarioCargo" min="0"  step="0.01" placeholder="0" required>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal para registrar beneficiario -->
<div class="modal fade" id="beneficiaryModal" tabindex="-1" role="dialog" aria-labelledby="beneficiaryModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="beneficiaryModalLabel">Register Beneficiary</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formBeneficiario" class="user" th:action="@{/beneficiarios/guardar-beneficiario/{idp}(idp=${project.id})}" th:method="post" th:object="${beneficiary}">
          <div class="row">
            <div class="col">
              <div class="form-group">
                  <!-- Campo oculto para el ID -->
    			<input type="hidden" th:field="*{id}" th:value="0">
                <label for="inputtipoB" class="form-label">Beneficiary Type</label>
                <select th:field="*{tipo}" class="form-control form-control-user" id="inputtipoB" required  onchange="updateLabel()">
                  <option value="" th:if="${beneficiary.id == null}" selected disabled>Select type</option>
                  <option value="Natural Person" th:selected="${beneficiary.tipo == 'Natural Person'}">Natural Person</option>
                  <option value="Legal Entity" th:selected="${beneficiary.tipo == 'Legal Entity'}">Legal Entity</option>
                  <option value="Staff" th:selected="${beneficiary.tipo == 'Staff'}">Staff</option>
                </select>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputdocumento" class="form-label" id = "documento"></label>
                <input th:field="*{documento}" type="text" class="form-control form-control-user" id="inputdocumento" placeholder="Document Number" required>
              </div>
            </div>
          </div>

          <div class="row" >
            <div class="col">
              <div class="form-group">
                <label for="inputnombres" class="form-label" id ="firstName"></label>
                <input th:field="*{nombres}" type="text" class="form-control form-control-user" id="inputnombre" placeholder="Enter first name" >
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputapellidos" class="form-label" id="lastName"></label>
                <input th:field="*{apellidos}" type="text" class="form-control form-control-user" id="inputapellidos" placeholder="Enter Last name" >
              </div>
            </div>
          </div>
         <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputrazonSocial" class="form-label" id ="company"></label>
                <input th:field="*{razonSocial}" type="text" class="form-control form-control-user" id="inputrazonSocial" placeholder="Enter company name ">
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputpaisProcedencia" class="form-label">Country origin</label>
                <select th:field="*{pais}" class="form-control form-control-user" id="inputpaisProcedencia" 
                	data-show-subtext="true" data-live-search="true" required>
                  <option value=""  selected>Select country</option>
                  <option th:each="paiss : ${paisesBeneficiary}"
                  		  th:value="${paiss.id}" 
                  		  th:text="${paiss.nombre}">
                  </option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="inputemail" class="form-label" id = "email"></label>
                <input th:field="*{email}" type="email" class="form-control form-control-user" id="inputemail" placeholder="example@gmail.com" >
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="inputtelefonoContacto" class="form-label">Contact phone</label>
                <input th:field="*{telefonoContacto}" type="text" class="form-control form-control-user" id="inputtelefonoContacto" placeholder="Contact phone">
              </div>
            </div>
          </div>
          <div class="row">
	                                    <div class="col">
	                                        <div class="form-group">
	                                            <label for="inputfechaIngreso" class="form-label">Start Date(if applicable)</label>
	                                            <input th:field="*{fechaIngreso}" type="date" class="form-control form-control-user" id="inputfechaIngreso" >
	                                        </div>
	                                    </div>
	                                    <div class="col">
	                                        <div class="form-group">
	                                            <label for="inputobservacion" class="form-label">Observation</label>
	                                            <textarea th:field="*{observacion}" class="form-control form-control-user" id="inputobservacion" placeholder="Observations" rows="3"></textarea>
	                                        </div>
	                                    </div>
         </div>
                                         <!-- Mostrar mensaje de error si existe -->
                                <div th:if="${error}" class="alert alert-danger" role="alert" style="color: red;">
                                    <p th:text="${error}"></p>
                                </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary">Save Beneficiary</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- Footer -->
   <footer th:replace="design/footerBar :: footerbar"></footer>
<!-- End of Footer -->
<div th:replace="design/script :: scripts"></div>

<script>
// FunciÃ³n para actualizar 'inputCargoItem' con el valor de 'inputItem' o 'selectCargo'
function updateCargoItem(value) {
    document.getElementById("inputCargoItem").value = value;
}


</script>

<script>

// Llama a esta funciÃ³n para actualizar el valor antes de enviar el formulario
function prepareMonto(elementId) {
	
    const element = document.getElementById(elementId);
    element.value = element.value.replace(/,/g, ''); // Elimina comas antes de enviar al servidor
}
</script>
    <script>
        // FunciÃ³n para prevenir el envÃ­o del formulario con la tecla Enter
        function disableEnterKey(event) {
            if (event.key === "Enter") {
                event.preventDefault(); // Previene la acciÃ³n predeterminada (enviar el formulario)
            }
        }
        // AÃ±adir el listener al cargar el documento
        document.addEventListener("DOMContentLoaded", function() {
            const form = document.getElementById("miFormulario"); // Cambia "miFormulario" por el ID de tu formulario
            form.addEventListener("keypress", disableEnterKey);
        });

    </script>
<script>
function loadBeneficiaryData() {
    var select = document.getElementById("beneficiarioE");
    var selectedOption = select.options[select.selectedIndex];

    // Obtener los datos del beneficiario seleccionado
    var tipo = selectedOption.getAttribute("data-tipo");
    var documento = selectedOption.getAttribute("data-documento");
    var nombres = selectedOption.getAttribute("data-nombres");
    var apellidos = selectedOption.getAttribute("data-apellidos");

    // Actualizar los campos de entrada
    document.getElementById("inputIdBeneficiario").value = selectedOption.value;
    document.getElementById("inputBeneficiario").value = nombres + ' ' + apellidos;

    // Actualizar las etiquetas <p>
    document.getElementById("beneficiarioTipo").textContent = tipo;
    document.getElementById("beneficiarioDocumento").textContent = documento;
    document.getElementById("beneficiarioNombre").textContent = nombres + ' ' + apellidos;
}
</script>   
<script>
function openModal() {
    // Limpiar el campo ID para crear un nuevo registro
    document.getElementById("inputId").value = 0;
    
    // Limpiar otros campos del formulario si es necesario
    document.getElementById("inputdocumento").value = "";
    // Limpiar otros campos del formulario...

    // Mostrar el modal
    $('#myModal').modal('show');
}

</script> 
<script type='text/javascript'>
$(function(){
    $(document).bind("contextmenu",function(e){
        return false;
    });
});
</script>
<script>
function toggleFields(selectElement) {
    // Obtener el valor de `nombreClase` del atributo data-nombreClase del option seleccionado
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    const nombreClase = selectedOption.getAttribute("data-nombreClase");
    const formaPago = selectedOption.getAttribute("data-formaPago");// Obtener la forma de pago de clasificacion

    const expenseObjetoPuestoLabel = document.getElementById("expenseObjetoPuesto");
    const expenseCargoItemLabel = document.getElementById("expenseCargoItem");
    const expensePrecioUnitarioMontoLabel = document.getElementById("expensePrecioUnitarioMonto");
    const inputCargoItem = document.getElementById("inputCargoItem");
    const inputItem = document.getElementById("inputItem");
    const selectCargo = document.getElementById("selectCargo");
    const btnAddCargo = document.getElementById("btnAddCargo");

    document.getElementById("inputPago").value = formaPago;
    
    if (nombreClase === "STAFF") {
        expenseObjetoPuestoLabel.textContent = "Job Position";
        expenseCargoItemLabel.textContent = "Scale";
        expensePrecioUnitarioMontoLabel.textContent = "Amount to pay";
        selectCargo.style.display = "block";
        inputItem.style.display = "none";
        btnAddCargo.style.display = "block";
     // Reiniciar valor de 'inputCargoItem' para evitar datos inconsistentes
        inputCargoItem.value = "";
    } else {
        expenseObjetoPuestoLabel.textContent = "Object";
        expenseCargoItemLabel.textContent = "Item";
        expensePrecioUnitarioMontoLabel.textContent = "Unit Cost";
        selectCargo.style.display = "none";
        inputItem.style.display = "block";
        btnAddCargo.style.display = "none";
        // Reiniciar el valor de 'inputCargoItem' (puedes agregar mÃ¡s reinicios si es necesario)
        inputCargoItem.value = "";
    }

}
</script>

<script>
function toggleFechaFin(selectElement) {
    // Obtener el valor seleccionado
    const selectedOption = selectElement.options[selectElement.selectedIndex];
    //const formaPago = selectedOption.value;  // Asumiendo que 'formaPago' estÃ¡ despuÃ©s de '->'
    const formaPago = selectedOption.getAttribute("data-formaPago");// Obtener la forma de pago de clasificacion
//alert(formaPago);
    // Obtener el campo de fechaFin y tiempo
    const fechaInicioInput = document.getElementById('inputfechaInicio'); 
    const fechaFinInput = document.getElementById('inputfechaFin'); 
    const tiempoInput = document.getElementById('inputTiempo');
    

    // Verificar si formaPago es 'pago Ãºnico'
    if (formaPago === 'single payment') {
    	fechaFinInput.readOnly = true; // fechaFinInput.disabled = true; // Deshabilitar
    	fechaInicioInput.value='';
        fechaFinInput.value = ''; // Limpiar valor si estÃ¡ deshabilitado
        //tiempoInput.disabled = true;
        tiempoInput.value = '1';
        
        
    } else {
    	fechaFinInput.readOnly = false; // Quitar readonly

        //fechaFinInput.disabled = false; // Habilitar
        //tiempoInput.disabled = false;
    }
}
</script>
<script>
    
    function checkDates() {
        const fechaInicioStr = document.getElementById('inputfechaInicio').value;
        const fechaFinStr = document.getElementById('inputfechaFin').value;
        const formaPago = document.getElementById('inputPago').value;
        
        // Verificar si se ingresÃ³ la fecha de inicio
        if (fechaInicioStr) {
            const [yearInicio, monthInicio, dayInicio] = fechaInicioStr.split("-");
            const fechaInicio = new Date(Date.UTC(yearInicio, monthInicio - 1, dayInicio));

            if (isNaN(fechaInicio.getTime())) {
                alert("Por favor, ingresa una fecha de inicio vÃ¡lida.");
                return;
            }

            let fechaFin;
            
            // Si el tipo de forma de pago no es 'single payment', se requiere una fecha de fin vÃ¡lida
            if (formaPago !== 'single payment') {
                if (fechaFinStr) {
                    const [yearFin, monthFin, dayFin] = fechaFinStr.split("-");
                    fechaFin = new Date(Date.UTC(yearFin, monthFin - 1, dayFin));

                    if (isNaN(fechaFin.getTime())) {
                        alert("Por favor, ingresa una fecha de fin vÃ¡lida.");
                        return;
                    }
                } else {
                    alert("Por favor, ingresa la fecha de fin.");
                    return;
                }
            } else {
                // Si la forma de pago es 'single payment', se permite que fechaFin estÃ© vacÃ­a
                fechaFin = fechaInicio; // Se asigna la fecha de inicio como fecha de fin
            }

            // Llamar a la funciÃ³n para calcular el tiempo con fechaInicio y fechaFin
            calculateInputTiempo(fechaInicio, fechaFin);

        } else {
            alert("Por favor, completa la fecha de inicio.");
        }
    }

    function calculateInputTiempo(fechaInicial, fechaFinal) {
        if (!fechaInicial || !fechaFinal) {
            return; // No calcular si alguna fecha es nula o indefinida
        }
        // Extraer dÃ­a, mes y aÃ±o de las fechas
        //alert(fechaInicial+'jo'+fechaFinal);
        const diaInicial = fechaInicial.getDate();
        const mesInicial = fechaInicial.getMonth() + 1; // Los meses en JavaScript son 0-indexed
        const anoInicial = fechaInicial.getFullYear();
        
        const diaFinal = fechaFinal.getDate();
        const mesFinal = fechaFinal.getMonth() + 1; // Los meses en JavaScript son 0-indexed
        const anoFinal = fechaFinal.getFullYear();
        
        //alert("DIA "+diaInicial);
        
        let dias;

        // Ajuste para febrero y el Ãºltimo dÃ­a del mes
        if ((mesFinal === 2 && diaFinal >= 28) || (mesFinal !== 2 && diaFinal >= 30)) {
            diaFinal = 30;
            
        }
        // Ajustar si el dÃ­a final es menor que el dÃ­a inicial
        if (diaFinal < diaInicial) {
            diaFinal += 30;
            mesFinal -= 1;
            alert("Ajustar si el dÃ­a final es menor que el dÃ­a inicial");
        }
        // Ajustar si el mes final es menor que el mes inicial
        if (mesFinal < mesInicial) {
            mesFinal += 12;
            anoFinal -= 1;
            alert("Ajustar si el mes final es menor que el mes inicial");
        }
    // Calcular el total de dÃ­as
        dias = (diaFinal + 1 - diaInicial) +
               ((mesFinal - mesInicial) * 30) +
               ((anoFinal - anoInicial) * 360);

        //return dias;
    alert(dias);
    document.getElementById('inputTiempo').value = dias; // Establece el valor calculado
    }

</script>
<script>
function calculateTotalMontoPagar() {
    const cantidad = parseFloat(document.getElementById("inputCantidad").value) || 0;
    const precioUnitario = parseFloat(document.getElementById("inputPrecioUnitario").value) || 0;
    const tiempo = parseFloat(document.getElementById("inputTiempo").value) || 1;
        // Calcular montos
        const montoTotalPagar = (cantidad * precioUnitario) * tiempo;

        const formateador = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        // Formatear monto solo para mostrarlo
        document.getElementById("inputMontoPagar").value = formateador.format(montoTotalPagar);
}

function calculateTotalLCU() {
    const fee = parseFloat(document.getElementById("inputFee").value) || 0;
    const cambioMoneda = parseFloat(document.getElementById("inputCambioMoneda").value) || 0;

        // Calcular montos
        const montoLCU = (fee * cambioMoneda);

        const formateador = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        document.getElementById("inputTotalLCU").value = formateador.format(montoLCU);

}
</script>
<script>
document.getElementById('btnAttach').addEventListener('click', function() {
    document.getElementById('fileInput').click();
});

document.getElementById('fileInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
        // AquÃ­ podrÃ­as subir el archivo a tu servidor y obtener la URL
        // Por ejemplo, usando una llamada AJAX o un formulario de envÃ­o de archivos

        // Por ahora, simplemente aÃ±adimos el nombre del archivo al campo de texto
        document.getElementById('inputAttach').value = file.name;
    }
});

</script>
<script>
    function updateLabel() {
        const select = document.getElementById("inputtipoB");
        const label = document.getElementById("documento");
        const labelF = document.getElementById("firstName");
        const labelL = document.getElementById("lastName");
        const labelE = document.getElementById("email");
        const labelC = document.getElementById("company");
        
        if (select.value === "Staff") {
            label.textContent = "Identification Document (*)";
            labelF.textContent ="First Name (*)";
            labelL.textContent ="Last Name (*)";
            labelE.textContent = "Email (*)";
            labelC.textContent = "Company Name";
            document.getElementById("inputnombre").required=true;
            document.getElementById("inputapellidos").required=true;
            document.getElementById("inputrazonSocial").required=false;
            document.getElementById("inputemail").required=true;
            
            
        } else if  (select.value === "Legal Entity"){
        	
            label.textContent = "Number Identification of Company (*)";
            labelF.textContent ="First Name (Legal representative) ";
            labelL.textContent ="Last Name (Legal representative) ";
            labelE.textContent = "Email";
            labelC.textContent = "Company Name (*)";
            document.getElementById("inputnombre").required=false;
            document.getElementById("inputapellidos").required=false;
            document.getElementById("inputrazonSocial").required=true;
            document.getElementById("inputemail").required=false;
        }
        else
        	{
            label.textContent = "Identification Document (*)";
            labelF.textContent ="First Name (*)";
            labelL.textContent ="Last Name (*)";
            labelE.textContent = "Email";
            labelC.textContent = "Company Name";
            document.getElementById("inputnombre").required=true;
            document.getElementById("inputapellidos").required=true;
            document.getElementById("inputrazonSocial").required=false;
            document.getElementById("inputemail").required=false;
        	}
    }

    // Call updateLabel on page load to set the label correctly if editing an existing record
    window.onload = updateLabel;
</script>

</body>
</html>








